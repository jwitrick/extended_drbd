# Generated by Chef for <%= node[:fqdn] %>

global {
  usage-count no;
}
common {
  <% if node['drbd']['net']['enabled'] -%>
  net{
    <% if node['drbd']['net']['sndbuf-size'] -%>
    sndbuf-size <%=node['drbd']['net']['sndbuf-size']%>;
    <% end -%>
    <% if node['drbd']['net']['max-buffers'] -%>
    max-buffers <%=node['drbd']['net']['max-buffers']%>;
    <% end -%>
    <% if node['drbd']['net']['max-epoch-size'] -%>
    max-epoch-size <%=node['drbd']['net']['max-epoch-size']%>;
    <% end -%>
  }
  <% end -%>
  disk {
  on-io-error <%=node['drbd']['disk']['on_io_error_action']%>;
  <% if not node['drbd']['disk']['disk-flushes'] -%>
  no-disk-flushes;
  <% end -%>
  <% if not node['drbd']['disk']['md-flushes'] -%>
  no-md-flushes;
  <% end -%>
  <% if not node['drbd']['disk']['no-disk-barrier'] -%>
  no-disk-barrier;
  <% end -%>
  }
  protocol <%=node['drbd']['protocol']%>;
}
resource <%= @resource %> {
  on <%= @my_short_hostname %> {
    device    <%= node['drbd']['dev'] %>;
    disk      <%= node['drbd']['disk']['start']%><%=node['lvm']['vg_name']%><%=node['drbd']['mount'] %>;
    address   <%=@my_ip%>:<%= node['drbd']['port'] %>;
    meta-disk internal;
  }
  on <%= @partner_short_hostname %> {
    device    <%= node['drbd']['dev'] %>;
    disk      <%= node['drbd']['disk']['start']%><%=node['lvm']['vg_name']%><%=node['drbd']['mount'] %>;
    address   <%= @partner_ip %>:<%= node['drbd']['port'] %>;
    meta-disk internal;
  }
  syncer {
     rate <%= node['drbd']['syncrate']%>;
  }
}

